<%- include('../admin/layout/adminSidebar.ejs') -%> <%-
include('../admin/layout/adminHeader.ejs') -%>

<!-- partial -->

<!-- partial -->
<div class="main-panel">
  <div class="content-wrapper">
    <div class="row">
      <div class="col-sm-4 grid-margin">
        <div class="card">
          <div class="card-body">
            <h5>Revenue</h5>
            <div class="row">
              <div class="col-8 col-sm-12 col-xl-8 my-auto">
                <div class="d-flex d-sm-block d-md-flex align-items-center">
                  <h2 class="mb-0">â‚¹0</h2>
                  <p class="text-success ml-2 mb-0 font-weight-medium">
                    +0.00 Pending
                  </p>
                </div>
                <h6 class="text-muted font-weight-normal">
                  0 Pending Revenue from last month
                </h6>
              </div>
              <div class="col-4 col-sm-12 col-xl-4 text-center text-xl-right">
                <i class="icon-lg mdi mdi-codepen text-primary ml-auto"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-4 grid-margin">
        <div class="card">
          <div class="card-body">
            <h5>Sales</h5>
            <div class="row">
              <div class="col-8 col-sm-12 col-xl-8 my-auto">
                <div class="d-flex d-sm-block d-md-flex align-items-center">
                  <h2 class="mb-0">0</h2>
                  <p class="text-success ml-2 mb-0 font-weight-medium">
                    +0 Pending to Delivery
                  </p>
                </div>
                <h6 class="text-muted font-weight-normal">No data available</h6>
              </div>
              <div class="col-4 col-sm-12 col-xl-4 text-center text-xl-right">
                <i
                  class="icon-lg mdi mdi-wallet-travel text-danger ml-auto"
                ></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-4 grid-margin">
        <div class="card">
          <div class="card-body">
            <h5>Users</h5>
            <div class="row">
              <div class="col-8 col-sm-12 col-xl-8 my-auto">
                <div class="d-flex d-sm-block d-md-flex align-items-center">
                  <h2 class="mb-0">0</h2>
                  <p class="text-success ml-2 mb-0 font-weight-medium">
                    0 Users Only Purchased
                  </p>
                </div>
                <h6 class="text-muted font-weight-normal">No data available</h6>
              </div>
              <div class="col-4 col-sm-12 col-xl-4 text-center text-xl-right">
                <i class="icon-lg mdi mdi-monitor text-success ml-auto"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6 col-xl-6 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-row justify-content-between">
              <h4 class="card-title">Download Sales Report</h4>
              <p class="text-muted mb-1 small"></p>
            </div>
            <div class="btns">
              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <input
                      type="date"
                      class="form-control"
                      id="fromDate"
                      placeholder="From"
                      name="fromDate"
                      required
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <div class="input-group">
                      <input
                        type="date"
                        class="form-control"
                        id="toDate"
                        placeholder="To"
                        name="toDate"
                        required
                      />
                      <button
                        type="button"
                        class="btn btn-primary"
                        onclick="downloadCustomReport()"
                      >
                        Download
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6 col-xl-6 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-row justify-content-between">
              <h4 class="card-title">Quick Reports</h4>
              <p class="text-muted mb-1 small">
                <a href="/admin/downloadSalesReport"
                  ><i class="fa fa-download"></i
                ></a>
              </p>
            </div>
            <div class="btns">
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <a
                      href="/admin/downloadSalesReport?button=lastWeek"
                      class="btn btn-primary btn-block"
                      onclick="downloadReport('lastWeek')"
                      >Last Week</a
                    >
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <a
                      href="/admin/downloadSalesReport?button=lastMonth"
                      class="btn btn-primary btn-block"
                      onclick="downloadReport('lastMonth')"
                      >Last Month</a
                    >
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <a
                      href="/admin/downloadSalesReport?button=lastYear"
                      class="btn btn-primary btn-block"
                      onclick="downloadReport('lastYear')"
                      >Last Year</a
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-3 col-xl-3 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-row justify-content-between">
              <h4 class="card-title">Revenue Overview</h4>
              <p class="text-muted mb-1 small"></p>
            </div>

            <div
              class="chart-container d-flex justify-content-center position-absolute"
            >
              <canvas id="myChart" class="chart"></canvas>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-xl-3 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-row justify-content-between">
              <h4 class="card-title">Sales Overview</h4>
              <nav class="d-flex flex-row justify-content-end">
                <select
                  class="form-control form-control-sm"
                  id="salesOrder"
                  onchange="salesOrderFilter(this.value)"
                >
                  <option value="week">Last Week</option>
                  <option value="month">Last Month</option>
                  <option value="year">Last Year</option>
                </select>
              </nav>
            </div>

            <div
              id="chart-container d-flex justify-content-center position-absolute"
              class="d-flex justify-content-center"
            >
              <canvas id="productStatusChart" class="chart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-6 col-xl-6 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <div class="d-flex flex-row justify-content-between">
              <h4 class="card-title">Latest Sales</h4>
              <p class="text-muted mb-1 small">View all</p>
            </div>

            <div class="preview-list">
              <div class="preview-item-content d-sm-flex flex-grow">
                <div class="flex-grow">
                  <h6 class="preview-subject">No sales</h6>
                  <p class="text-muted mb-0">No data available</p>
                </div>
                <div class="mr-auto text-sm-right pt-2 pt-sm-0">
                  <p class="text-muted">No data</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

    <div class="row"></div>

    <!-- <div class="row">
        <div class="col-md-6 col-xl-4 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <div class="d-flex flex-row justify-content-between">
                <h4 class="card-title">Messages</h4>
                <p class="text-muted mb-1 small">View all</p>
              </div>
              <div class="preview-list">
                <div class="preview-item border-bottom">
                  <div class="preview-thumbnail">
                    <img src="/admin/images/faces/face6.jpg" alt="image"
                      class="rounded-circle" />
                  </div>
                  <div class="preview-item-content d-flex flex-grow">
                    <div class="flex-grow">
                      <div
                        class="d-flex d-md-block d-xl-flex justify-content-between">
                        <h6 class="preview-subject">Leonard</h6>
                        <p class="text-muted text-small">5 minutes ago</p>
                      </div>
                      <p class="text-muted">Well, it seems to be working now.</p>
                    </div>
                  </div>
                </div>
                <div class="preview-item border-bottom">
                  <div class="preview-thumbnail">
                    <img src="/admin/images/faces/face8.jpg" alt="image"
                      class="rounded-circle" />
                  </div>
                  <div class="preview-item-content d-flex flex-grow">
                    <div class="flex-grow">
                      <div
                        class="d-flex d-md-block d-xl-flex justify-content-between">
                        <h6 class="preview-subject">Luella Mills</h6>
                        <p class="text-muted text-small">10 Minutes Ago</p>
                      </div>
                      <p class="text-muted">Well, it seems to be working now.</p>
                    </div>
                  </div>
                </div>
                <div class="preview-item border-bottom">
                  <div class="preview-thumbnail">
                    <img src="/admin/images/faces/face9.jpg" alt="image"
                      class="rounded-circle" />
                  </div>
                  <div class="preview-item-content d-flex flex-grow">
                    <div class="flex-grow">
                      <div
                        class="d-flex d-md-block d-xl-flex justify-content-between">
                        <h6 class="preview-subject">Ethel Kelly</h6>
                        <p class="text-muted text-small">2 Hours Ago</p>
                      </div>
                      <p class="text-muted">Please review the tickets</p>
                    </div>
                  </div>
                </div>
                <div class="preview-item border-bottom">
                  <div class="preview-thumbnail">
                    <img src="/admin/images/faces/face11.jpg" alt="image"
                      class="rounded-circle" />
                  </div>
                  <div class="preview-item-content d-flex flex-grow">
                    <div class="flex-grow">
                      <div
                        class="d-flex d-md-block d-xl-flex justify-content-between">
                        <h6 class="preview-subject">Herman May</h6>
                        <p class="text-muted text-small">4 Hours Ago</p>
                      </div>
                      <p class="text-muted">Thanks a lot. It was easy to fix it
                        .</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6 col-xl-4 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">Portfolio Slide</h4>
              <div
                class="owl-carousel owl-theme full-width owl-carousel-dash portfolio-carousel"
                id="owl-carousel-basic">
                <div class="item">
                  <img src="/admin/images/dashboard/Rectangle.jpg" alt>
                </div>
                <div class="item">
                  <img src="/admin/images/dashboard/Img_5.jpg" alt>
                </div>
                <div class="item">
                  <img src="/admin/images/dashboard/img_6.jpg" alt>
                </div>
              </div>
              <div class="d-flex py-4">
                <div class="preview-list w-100">
                  <div class="preview-item p-0">
                    <div class="preview-thumbnail">
                      <img src="/admin/images/faces/face12.jpg"
                        class="rounded-circle" alt>
                    </div>
                    <div class="preview-item-content d-flex flex-grow">
                      <div class="flex-grow">
                        <div
                          class="d-flex d-md-block d-xl-flex justify-content-between">
                          <h6 class="preview-subject">CeeCee Bass</h6>
                          <p class="text-muted text-small">4 Hours Ago</p>
                        </div>
                        <p class="text-muted">Well, it seems to be working now.</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <p class="text-muted">Well, it seems to be working now. </p>
              <div class="progress progress-md portfolio-progress">
                <div class="progress-bar bg-success" role="progressbar"
                  style="width: 50%" aria-valuenow="25" aria-valuemin="0"
                  aria-valuemax="100"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-12 col-xl-4 grid-margin stretch-card">
          <div class="card">
            <div class="card-body">
              <h4 class="card-title">To do list</h4>
              <div class="add-items d-flex">
                <input type="text" class="form-control todo-list-input"
                  placeholder="enter task..">
                <button class="add btn btn-primary todo-list-add-btn">Add</button>
              </div>
              <div class="list-wrapper">
                <ul
                  class="d-flex flex-column-reverse text-white todo-list todo-list-custom">
                  <li>
                    <div class="form-check form-check-primary">
                      <label class="form-check-label">
                        <input class="checkbox" type="checkbox"> Create invoice
                      </label>
                    </div>
                    <i class="remove mdi mdi-close-box"></i>
                  </li>
                  <li>
                    <div class="form-check form-check-primary">
                      <label class="form-check-label">
                        <input class="checkbox" type="checkbox"> Meeting with
                        Alita </label>
                    </div>
                    <i class="remove mdi mdi-close-box"></i>
                  </li>
                  <li class="completed">
                    <div class="form-check form-check-primary">
                      <label class="form-check-label">
                        <input class="checkbox" type="checkbox" checked> Prepare
                        for presentation </label>
                    </div>
                    <i class="remove mdi mdi-close-box"></i>
                  </li>
                  <li>
                    <div class="form-check form-check-primary">
                      <label class="form-check-label">
                        <input class="checkbox" type="checkbox"> Plan weekend
                        outing </label>
                    </div>
                    <i class="remove mdi mdi-close-box"></i>
                  </li>
                  <li>
                    <div class="form-check form-check-primary">
                      <label class="form-check-label">
                        <input class="checkbox" type="checkbox"> Pick up kids
                        from school </label>
                    </div>
                    <i class="remove mdi mdi-close-box"></i>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div> -->
  </div>
  <!-- content-wrapper ends -->
  <!-- partial:partials/_footer.html -->

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Include jQuery or use a local copy -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const orderStatusSelects = document.querySelectorAll(".order-status");

      orderStatusSelects.forEach((select) => {
        select.addEventListener("click", function () {
          console.log("Order status clicked");

          const orderId = this.getAttribute("data-order-id");
          console.log("Order ID:", orderId);

          const newStatus = prompt(
            "Enter new status (approved, pending, or rejected):"
          );
          console.log("New status:", newStatus);

          if (newStatus) {
            console.log("Making AJAX request...");

            // Make an AJAX request to update the order status
            fetch("/update-order-status", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ orderId, newStatus }),
            })
              .then((response) => response.json())
              .then((data) => {
                console.log("Response:", data);

                if (data.success) {
                  // Update the displayed status
                  this.textContent =
                    newStatus.charAt(0).toUpperCase() + newStatus.slice(1);
                  // Optionally, update the badge color based on the new status
                  this.parentElement.className = `badge ${
                    newStatus === "approved"
                      ? "badge-outline-success"
                      : newStatus === "pending"
                      ? "badge-outline-warning"
                      : "badge-outline-danger"
                  }`;
                } else {
                  alert("Failed to update order status.");
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("Failed to update order status.");
              });
          }
        });
      });
    });

    // Define the changeOrderStatus function
    function changeOrderStatus(orderId) {
      console.log("in the fetch");
      const newStatus = event.target.value;
      console.log(newStatus);
      fetch(`/admin/update-order-status/${orderId}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ newStatus }),
      })
        .then((response) => response.json())
        .then((data) => {
          console.log("Success:", data);
          const orderTable = document.getElementById("orderTable");
          location.reload();
          // Optionally, update the UI or show a notification upon success
        })
        .catch((error) => {
          console.error("Error:", error);
          // Optionally, handle the error or show a notification
        });
      // Your implementation of changeOrderStatus
    }
  </script>

  <script>
    // Download the reports repending the buttons clicked
    function downloadCustomReport() {
      let start = document.getElementById("fromDate").value;
      let end = document.getElementById("toDate").value;
      $.ajax({
        type: "GET",
        url: "/admin/downloadSalesReport?button=custom",
        data: {
          fromDate: start,
          toDate: end,
        },
        contentType: "application/json",
        success: function (data) {
          //sweetalert("success")

          window.location.href = "/admin/download";
        },
        error: function (data) {
          console.log(data);
        },
      });
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Sample data
    var data = {
        labels: ['COD', 'Online', 'Wallet'],
        datasets: [{
          data: [12, 19, 1],
          backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
        }]
      };

      // Get the context of the canvas element
      var ctx = document.getElementById('myChart').getContext('2d');

      // Create a pie chart
      var myPieChart = new Chart(ctx, {
        type: 'pie',
        data: data
      });
  </script>
  <script>
    // Updated data for delivered products, pending, and returned
    let productStatusData = {
      labels: ["COD", " Online", "Wallet"],
      datasets: [
        {
          data: [10, 5, 6],
          backgroundColor: ["red", "green", "blue"],
        },
      ],
    };

    // Get the canvas element and render the line chart
    var ctx = document.getElementById("productStatusChart").getContext("2d");
    var productStatusChart = new Chart(ctx, {
      type: "doughnut", // Change this to 'line' for a line chart
      data: productStatusData,
    });
    let salesOrderFilter = async (filteredby) => {
      let data;
      if (filteredby == "week") {
        data = await fetchWeekData();
      } else if (filteredby == "month") {
        data = await fetchMonthData();
      } else if (filteredby == "year") {
        data = await fetchYearData();
      }
      updateChart(data);
    };
    const fetchWeekData = async () => {
      const response = await fetch("/admin/chartLastWeek");
      const data = await response.json();
      console.log(data);
      return data;
    };
    const fetchMonthData = async () => {
      const response = await fetch("/admin/chartLastMonth");
      const data = await response.json();
      console.log(data);
      return data;
    };
    const fetchYearData = async () => {
      const response = await fetch("/admin/chartLastYear");
      const data = await response.json();
      console.log(data);
      return data;
    };

    const updateChart = (totalData) => {
      var data = {
        labels: ["COD", " Online", "Wallet"],
        datasets: [
          {
            data: totalData,
            backgroundColor: ["red", "green", "blue"],
          },
        ],
      };

      productStatusChart.data = data;
      productStatusChart.update();
    };
  </script>

  <%- include('../admin/layout/adminFooter.ejs') -%>
</div>
